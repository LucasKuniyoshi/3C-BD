CREATE DATABASE Atv3

CREATE TABLE departamento (codDepartamento INT PRIMARY KEY AUTO_INCREMENT NOT NULL, nome VARCHAR(40) UNIQUE NOT NULL,descricaoFuncional VARCHAR(80), localizacao BLOB);
CREATE TABLE estado (siglaEstado VARCHAR(2) PRIMARY KEY, nome VARCHAR(30) UNIQUE NOT NULL);
CREATE TABLE cidade (codCidade INT PRIMARY KEY AUTO_INCREMENT, nome VARCHAR(30) UNIQUE NOT NULL, siglaEstado VARCHAR(2) NOT NULL REFERENCES estado(siglaEstado) ON DELETE no action ON UPDATE cascade);
CREATE TABLE vendedor (codVendedor INT PRIMARY KEY AUTO_INCREMENT, nome VARCHAR(60) NOT NULL, dataNascimento DATE, endereco VARCHAR(60), cep CHAR(8), telefone CHAR(20), codCidade INT DEFAULT 1, dataContratacao DATE DEFAULT (current_date), codDepartamento INT, FOREIGN KEY (codCidade) REFERENCES cidade(codCidade) ON DELETE cascade ON UPDATE cascade, FOREIGN KEY (codDepartamento) REFERENCES departamento(codDepartamento) ON DELETE set null);
CREATE TABLE cliente (codCliente INT PRIMARY KEY AUTO_INCREMENT, endereco VARCHAR(60), codCidade INT NOT NULL, telefone VARCHAR(20), tipo VARCHAR(1) CHECK (tipo in ('F', 'J')), dataCadastro DATE DEFAULT (current_date), cep VARCHAR(8), FOREIGN KEY (codCidade) REFERENCES cidade(codCidade) ON DELETE no action ON UPDATE cascade);
CREATE TABLE clienteFisico (codCliente INT PRIMARY KEY AUTO_INCREMENT, nome VARCHAR(50) NOT NULL, dataNascimento DATE, cpf CHAR(11) NOT NULL UNIQUE, rg CHAR(8), FOREIGN KEY (codCliente) REFERENCES cliente(codCliente) ON DELETE no action ON UPDATE cascade);
CREATE TABLE clienteJuridico (codCliente INT PRIMARY KEY AUTO_INCREMENT, nomeFantasia VARCHAR(80) UNIQUE, razaoSocial VARCHAR(80) UNIQUE NOT NULL, ie VARCHAR(20) UNIQUE NOT NULL, cgc VARCHAR(20) UNIQUE NOT NULL, FOREIGN KEY (codCliente) REFERENCES cliente(codCliente) ON DELETE no action ON UPDATE cascade);
CREATE TABLE classe (codClasse INT PRIMARY KEY AUTO_INCREMENT, sigla CHAR(12), nome VARCHAR(40) NOT NULL, descricao VARCHAR(80));
CREATE TABLE produto (codProduto INT PRIMARY KEY AUTO_INCREMENT, descricao VARCHAR(40) NOT NULL, unidadeMedida CHAR(2), embalagem VARCHAR(15) DEFAULT 'Fardo', codClasse INT, precoVenda NUMERIC(14,2), estoqueMinimo NUMERIC(14,2), FOREIGN KEY (codClasse) REFERENCES classe (codClasse) ON DELETE set null ON UPDATE set null);
CREATE TABLE produtoLote (codProduto INT, numeroLote INT, quantidadeAdquirida NUMERIC(14,2), quantidadeVendida NUMERIC(14,2), precoCusto NUMERIC(14,2), dataValidade DATE, PRIMARY KEY(codProduto, numeroLote),FOREIGN KEY (codProduto) REFERENCES produto (codProduto) ON DELETE cascade ON UPDATE cascade);
CREATE TABLE venda (codVenda INT PRIMARY KEY, codCliente INT, codVendedor INT DEFAULT 100, dataVenda DATE DEFAULT (current_date), enderecoEntrega VARCHAR(60), status VARCHAR(30), FOREIGN KEY (codCliente) REFERENCES cliente (codCliente) ON DELETE set null ON UPDATE no action, FOREIGN KEY (codVendedor) REFERENCES vendedor (codVendedor) ON DELETE set null);
CREATE TABLE itemVenda (codVenda INT, codProduto INT, numeroLote INT, quantidade NUMERIC(14,2) NOT NULL, PRIMARY KEY(codVenda, codProduto, numeroLote),FOREIGN KEY (codVenda) REFERENCES venda (codVenda) ON DELETE set null ON UPDATE cascade, FOREIGN KEY (codProduto, numeroLote) REFERENCES produtoLote (codProduto, numeroLote) ON DELETE no action);
CREATE TABLE fornecedor (codFornecedor INT PRIMARY KEY, nomeFantasia VARCHAR(80) UNIQUE, razaoSocial VARCHAR(80) UNIQUE NOT NULL, ie CHAR(20) NOT NULL UNIQUE, cgc VARCHAR(20) NOT NULL UNIQUE, endereco VARCHAR(60), telefone VARCHAR(20), codCidade INT, FOREIGN KEY (codCidade) REFERENCES cidade (codCidade) ON DELETE no action ON UPDATE cascade);
CREATE TABLE pedido (codPedido SERIAL PRIMARY KEY, dataRealizacao DATE DEFAULT '2024-09-19', dataEntrega DATE, codFornecedor INT, valor NUMERIC(20,2), FOREIGN KEY (codFornecedor) REFERENCES fornecedor (codFornecedor) ON DELETE cascade ON UPDATE set null);
CREATE TABLE itemPedido (codPedido INT, codProduto INT, quantidade NUMERIC(14,2) NOT NULL, PRIMARY KEY(codPedido, codProduto),FOREIGN KEY (codPedido) REFERENCES pedido (codPedido) ON DELETE cascade ON UPDATE cascade, FOREIGN KEY (codProduto) REFERENCES produto (codProduto));
CREATE TABLE contasPagar (codTitulo INT PRIMARY KEY, dataVencimento DATE NOT NULL, parcela INT, codPedido INT, FOREIGN KEY (codPedido) REFERENCES pedido (codPedido) ON DELETE cascade ON UPDATE cascade, valor NUMERIC(20,2), dataPagamento DATE, localPagamento VARCHAR(80), juros NUMERIC(12,2), correcaoMonetaria NUMERIC(12,2));
CREATE TABLE contasReceber (codTitulo INT PRIMARY KEY, dataVencimento DATE NOT NULL, codVenda INT, FOREIGN KEY (codVenda) REFERENCES venda (codVenda) ON DELETE cascade ON UPDATE cascade, parcela INT, valor NUMERIC(20,2), dataPagamento DATE, localPagamento VARCHAR(80), juros NUMERIC(12,2), correcaoMonetaria NUMERIC(12,2));